
#import <Foundation/Foundation.h>
typedef struct {
    Byte publisherSeem;
    Byte *perceptible;
    unsigned int decentDry;
    Byte magResolve;
	int magazineArticle;
	int distributeSeemTide;
	int odeUnity;
} DischargeData;

NSString *StringFromDischargeData(DischargeData *data);


//: menu_copy
DischargeData kHmValue = (DischargeData){67, (Byte []){46, 38, 45, 54, 28, 32, 44, 51, 58, 150}, 9, 169, 139, 137, 5};

//: report_Content
DischargeData coreResolveSettings = (DischargeData){151, (Byte []){229, 242, 231, 248, 229, 227, 200, 212, 248, 249, 227, 242, 249, 227, 152}, 14, 245, 7, 111, 182};

//: emoticon_emoji_%02ld
DischargeData commonGalleryHeliName = (DischargeData){28, (Byte []){121, 113, 115, 104, 117, 127, 115, 114, 67, 121, 113, 115, 118, 117, 67, 57, 44, 46, 112, 120, 147}, 20, 209, 148, 7, 69};

//: onTapMenuItemForword:
DischargeData commonMediumWealthStingFormat = (DischargeData){208, (Byte []){191, 190, 132, 177, 160, 157, 181, 190, 165, 153, 164, 181, 189, 150, 191, 162, 167, 191, 162, 180, 234, 68}, 21, 158, 154, 28, 45};

//: 转发
DischargeData appOriginalTitle = (DischargeData){42, (Byte []){194, 151, 134, 207, 165, 187, 181}, 6, 165, 216, 42, 114};

//: onTapMenuItemTranslation:
DischargeData appRationHelper = (DischargeData){222, (Byte []){177, 176, 138, 191, 174, 147, 187, 176, 171, 151, 170, 187, 179, 138, 172, 191, 176, 173, 178, 191, 170, 183, 177, 176, 228, 42}, 25, 220, 102, 55, 153};

//: menu_report
DischargeData colorWhenUtility = (DischargeData){102, (Byte []){11, 3, 8, 19, 57, 20, 3, 22, 9, 20, 18, 103}, 11, 243, 185, 111, 24};

//: onTapMenuItemRevoke:
DischargeData componentAwakeTooPage = (DischargeData){255, (Byte []){144, 145, 171, 158, 143, 178, 154, 145, 138, 182, 139, 154, 146, 173, 154, 137, 144, 148, 154, 197, 196}, 20, 248, 43, 89, 80};

//: 撤回
DischargeData kUnityPath = (DischargeData){43, (Byte []){205, 185, 143, 206, 176, 181, 128}, 6, 157, 187, 248, 35};

//: menu_forword
DischargeData featurePlaneCivicContent = (DischargeData){173, (Byte []){192, 200, 195, 216, 242, 203, 194, 223, 218, 194, 223, 201, 68}, 12, 160, 135, 60, 228};

//: 翻译
DischargeData spacingApePooSettings = (DischargeData){4, (Byte []){227, 187, 191, 236, 171, 149, 102}, 6, 254, 18, 226, 244};

//: menu_revoke
DischargeData viewKindDragFineMessage = (DischargeData){38, (Byte []){75, 67, 72, 83, 121, 84, 67, 80, 73, 77, 67, 227}, 11, 195, 226, 210, 65};

//: 复制
DischargeData appSeemErnValue = (DischargeData){1, (Byte []){228, 165, 140, 228, 137, 183, 75}, 6, 218, 157, 13, 108};

//: onTapMenuItemReport:
DischargeData featureCostConfig = (DischargeData){145, (Byte []){254, 255, 197, 240, 225, 220, 244, 255, 228, 216, 229, 244, 252, 195, 244, 225, 254, 227, 229, 171, 59}, 20, 181, 248, 119, 68};

//: onTapMenuItemCopy:
DischargeData colorBoundValue = (DischargeData){24, (Byte []){119, 118, 76, 121, 104, 85, 125, 118, 109, 81, 108, 125, 117, 91, 119, 104, 97, 34, 133}, 18, 253, 80, 169, 139};

//: menu_translation
DischargeData screenSliceKey = (DischargeData){93, (Byte []){48, 56, 51, 40, 2, 41, 47, 60, 51, 46, 49, 60, 41, 52, 50, 51, 53}, 16, 195, 33, 9, 244};

// __DEBUG__
// __CLOSE_PRINT__
//
//  MagnitudeeractBase.m
//  NIM
//
//  Created by amao on 8/11/15.
//  Copyright (c) 2015 Netease. All rights reserved.
//

// __M_A_C_R_O__
//: #import "ZZZSessionConfigBase.h"
#import "MagnitudeeractBase.h"
//: #import "ZZZMediaItem.h"
#import "InstrumentalityItem.h"
//: #import "NTESBundleSetting.h"
#import "StackChoose.h"
//: #import "NTESSnapchatAttachment.h"
#import "BuildAgile.h"
//: #import "NTESWhiteboardAttachment.h"
#import "WhiteboardAttachment.h"
//: #import "NTESBundleSetting.h"
#import "StackChoose.h"
//: #import "NSString+NTES.h"
#import "NSString+KingdomNtes.h"
//: #import "ZZZSessionConfig.h"
#import "Config.h"
//: #import "NTESSessionUtil.h"
#import "CommunicativeUtil.h"
//: #import "ZZZInputEmoticonManager.h"
#import "Dominant.h"
//: #import "ZZZKitUtil.h"
#import "PayerMinimal.h"

//: @interface ZZZSessionConfigBase()
@interface MagnitudeeractBase()
//: @property (nonatomic,strong) NIMMessage *threadMessage;
@property (nonatomic,strong) NIMMessage *threadMessage;
//: @end
@end

//: @implementation ZZZSessionConfigBase
@implementation MagnitudeeractBase

//: - (NIMAudioType)recordType
- (NIMAudioType)antitypeFound
{
    //: return [[NTESBundleSetting sharedConfig] usingAmr] ? NIMAudioTypeAMR : NIMAudioTypeAAC;
    return [[StackChoose need] box] ? NIMAudioTypeAMR : NIMAudioTypeAAC;
}


//: - (void)setThreadMessage:(NIMMessage *)message
- (void)setThreadMessage:(NIMMessage *)message
{
    //: _threadMessage = message;
    _threadMessage = message;
}

//: - (BOOL)autoFetchAttachment {
- (BOOL)safelyAttachment {
    //: return [[NTESBundleSetting sharedConfig] autoFetchAttachment];
    return [[StackChoose need] safelyAttachment];
}

//: - (NSArray *)emotionItems
- (NSArray *)entry
{
    //NSArray *indexs = @[@(1),@(145),@(12),@(15),@(10),@(18),@(19)];
    //: NSArray *indexs = @[];
    NSArray *indexs = @[];
    //: NSMutableArray *items = [NSMutableArray array];
    NSMutableArray *items = [NSMutableArray array];
    //: for (NSNumber *index in indexs)
    for (NSNumber *index in indexs)
    {
        //: NSString * ID = [NSString stringWithFormat:@"emoticon_emoji_%02ld", [index integerValue]];
        NSString * ID = [NSString stringWithFormat:StringFromDischargeData(&commonGalleryHeliName), [index integerValue]];
        //: NIMInputEmoticon *item = [[ZZZInputEmoticonManager sharedManager] emoticonByID:ID];
        DepictEmoticon *item = [[Dominant playCreation] dismiss:ID];
        //: if (item)
        if (item)
        {
            //: [items addObject:item];
            [items addObject:item];
        }
    }

    //: return [items copy];
    return [items copy];
}

//: - (NSArray *)mediaItems
- (NSArray *)acceptItems
{
    //: NSArray *defaultMediaItems = [AppleProjectKit sharedKit].config.defaultMediaItems;
    NSArray *defaultMediaItems = [Reek style].config.indexItems;

//    InstrumentalityItem *janKenPon = [InstrumentalityItem item:@"onTapMediaItemJanKenPon:"
//                                     normalImage:[UIImage imageNamed:@"icon_jankenpon_normal"]
//                                   selectedImage:[UIImage imageNamed:@"icon_jankenpon_pressed"]
//                                           title:LangKey(@"message_send_RPS")];//@"石头剪刀布".ntes_localized

//    InstrumentalityItem *fileTrans = [InstrumentalityItem item:@"onTapMediaItemFileTrans:"
//                                                normalImage:[UIImage imageNamed:@"icon_file_trans_normal"]
//                                              selectedImage:[UIImage imageNamed:@"icon_file_trans_pressed"]
//                                           title:LangKey(@"message_send_transfer")];//@"文件传输".ntes_localized

//    InstrumentalityItem *tip       = [InstrumentalityItem item:@"onTapMediaItemTip:"
//                                     normalImage:[UIImage imageNamed:@"bk_media_tip_normal"]
//                                   selectedImage:[UIImage imageNamed:@"bk_media_tip_pressed"]
//                                           title:@"提示消息".ntes_localized];

//    InstrumentalityItem *audioChat =  [InstrumentalityItem item:@"onTapMediaItemAudioChat:"
//                                      normalImage:[UIImage imageNamed:@"btn_media_telphone_message_normal"]
//                                    selectedImage:[UIImage imageNamed:@"btn_media_telphone_message_pressed"]
//                                           title:LangKey(@"message_send_voice_chat")];//@"实时语音".ntes_localized
//
//    InstrumentalityItem *videoChat =  [InstrumentalityItem item:@"onTapMediaItemVideoChat:"
//                                      normalImage:[UIImage imageNamed:@"btn_bk_media_video_chat_normal"]
//                                    selectedImage:[UIImage imageNamed:@"btn_bk_media_video_chat_pressed"]
//                                            title:LangKey(@"message_send_video_chat")];//@"视频聊天".ntes_localized
//
//    InstrumentalityItem *teamMeeting =  [InstrumentalityItem item:@"onTapMediaItemTeamMeeting:"
//                                      normalImage:[UIImage imageNamed:@"btn_media_telphone_message_normal"]
//                                    selectedImage:[UIImage imageNamed:@"btn_media_telphone_message_pressed"]
//                                            title:LangKey(@"message_send_video_chat")];//@"视频通话".ntes_localized

//    InstrumentalityItem *snapChat =   [InstrumentalityItem item:@"onTapMediaItemSnapChat:"
//                                      normalImage:[UIImage imageNamed:@"bk_media_snap_normal"]
//                                    selectedImage:[UIImage imageNamed:@"bk_media_snap_pressed"]
//                                            title:@"阅后即焚".ntes_localized];

//    InstrumentalityItem *whiteBoard = [InstrumentalityItem item:@"onTapMediaItemWhiteBoard:"
//                                      normalImage:[UIImage imageNamed:@"btn_whiteboard_invite_normal"]
//                                    selectedImage:[UIImage imageNamed:@"btn_whiteboard_invite_pressed"]
//
//                                            title:@"白板".ntes_localized];
    //红包功能因合作终止，暂时关闭
//    InstrumentalityItem *redPacket  = [InstrumentalityItem item:@"onTapMediaItemRedPacket:"
//                                      normalImage:[UIImage imageNamed:@"icon_redpacket_normal"]
//                                    selectedImage:[UIImage imageNamed:@"icon_redpacket_pressed"]
//                                            title:LangKey(@"message_send_red_packet")];//@"红包"

//    InstrumentalityItem *teamReceipt  = [InstrumentalityItem item:@"onTapMediaItemTeamReceipt:"
//                                      normalImage:[UIImage imageNamed:@"icon_team_receipt_normal"]
//                                    selectedImage:[UIImage imageNamed:@"icon_team_receipt_pressed"]
//                                            title:@"已读回执".ntes_localized];



//    BOOL isMe   = _session.sessionType == NIMSessionTypeP2P
//    && [_session.sessionId isEqualToString:[[NIMSDK sharedSDK].loginManager currentAccount]];
//    NSArray *items = nil;

//    if (isMe)
//    {
//        items = @[janKenPon,tip];
//    }
//    else if(_session.sessionType == NIMSessionTypeTeam || _session.sessionType == NIMSessionTypeSuperTeam)
//    {
//        items = @[janKenPon];
//    }
//    else
//    {
//        items = @[janKenPon];
//    }


//    return [defaultMediaItems arrayByAddingObjectsFromArray:items];
    //: return defaultMediaItems;
    return defaultMediaItems;
}

//: - (NSArray<ZZZMediaItem *> *)menuItemsWithMessage:(NIMMessage *)message {
- (NSArray<InstrumentalityItem *> *)ported:(NIMMessage *)message {
    //: NSMutableArray *items = [NSMutableArray array];
    NSMutableArray *items = [NSMutableArray array];

//    InstrumentalityItem *reply = [InstrumentalityItem item:@"onTapMenuItemReply:"
//                                 normalImage:[UIImage imageNamed:@"menu_reply"]
//                               selectedImage:nil
//                                       title:LangKey(@"回复")];

    //: ZZZMediaItem *copy = [ZZZMediaItem item:@"onTapMenuItemCopy:"
    InstrumentalityItem *copy = [InstrumentalityItem secure:StringFromDischargeData(&colorBoundValue)
                                //: normalImage:[UIImage imageNamed:@"menu_copy"]
                                we:[UIImage imageNamed:StringFromDischargeData(&kHmValue)]
                              //: selectedImage:nil
                              asset:nil
                                      //: title:[NTESLanguageManager getTextWithKey:@"复制"]];
                                      disable:[CarefulRage formatExtend:StringFromDischargeData(&appSeemErnValue)]];

    //: ZZZMediaItem *forword = [ZZZMediaItem item:@"onTapMenuItemForword:"
    InstrumentalityItem *forword = [InstrumentalityItem secure:StringFromDischargeData(&commonMediumWealthStingFormat)
                                   //: normalImage:[UIImage imageNamed:@"menu_forword"]
                                   we:[UIImage imageNamed:StringFromDischargeData(&featurePlaneCivicContent)]
                                 //: selectedImage:nil
                                 asset:nil
                                         //: title:[NTESLanguageManager getTextWithKey:@"转发"]];
                                         disable:[CarefulRage formatExtend:StringFromDischargeData(&appOriginalTitle)]];

//    InstrumentalityItem *mark = [InstrumentalityItem item:@"onTapMenuItemMark:"
//                                normalImage:[UIImage imageNamed:@"menu_collect"]
//                              selectedImage:nil
//                                      title:LangKey(@"收藏")];

//    BOOL isMessagePined = [NIMSDK.sharedSDK.chatExtendManager pinItemForMessage:message] != nil;
//    NSString *pinTitle = isMessagePined ? @"Un-pin": @"Pin";
//    NSString *pinAction = isMessagePined ? @"onTapMenuItemUnpin:" : @"onTapMenuItemPin:";
//    InstrumentalityItem *pin = [InstrumentalityItem item:pinAction
//                               normalImage:[UIImage imageNamed:@"menu_pin"]
//                             selectedImage:nil
//                                     title:pinTitle];

    //: ZZZMediaItem *report = [ZZZMediaItem item:@"onTapMenuItemReport:"
    InstrumentalityItem *report = [InstrumentalityItem secure:StringFromDischargeData(&featureCostConfig)
                                  //: normalImage:[UIImage imageNamed:@"menu_report"]
                                  we:[UIImage imageNamed:StringFromDischargeData(&colorWhenUtility)]
                                //: selectedImage:nil
                                asset:nil
                                        //: title:[NTESLanguageManager getTextWithKey:@"report_Content"]];
                                        disable:[CarefulRage formatExtend:StringFromDischargeData(&coreResolveSettings)]];

    //: ZZZMediaItem *translation = [ZZZMediaItem item:@"onTapMenuItemTranslation:"
    InstrumentalityItem *translation = [InstrumentalityItem secure:StringFromDischargeData(&appRationHelper)
                                  //: normalImage:[UIImage imageNamed:@"menu_translation"]
                                  we:[UIImage imageNamed:StringFromDischargeData(&screenSliceKey)]
                                //: selectedImage:nil
                                asset:nil
                                        //: title:[NTESLanguageManager getTextWithKey:@"翻译"]];
                                        disable:[CarefulRage formatExtend:StringFromDischargeData(&spacingApePooSettings)]];

    //: ZZZMediaItem *revoke = [ZZZMediaItem item:@"onTapMenuItemRevoke:"
    InstrumentalityItem *revoke = [InstrumentalityItem secure:StringFromDischargeData(&componentAwakeTooPage)
                                  //: normalImage:[UIImage imageNamed:@"menu_revoke"]
                                  we:[UIImage imageNamed:StringFromDischargeData(&viewKindDragFineMessage)]
                                //: selectedImage:nil
                                asset:nil
                                        //: title:[NTESLanguageManager getTextWithKey:@"撤回"]];
                                        disable:[CarefulRage formatExtend:StringFromDischargeData(&kUnityPath)]];

//    InstrumentalityItem *delete = [InstrumentalityItem item:@"onTapMenuItemDelete:"
//                                  normalImage:[UIImage imageNamed:@"menu_del"]
//                                selectedImage:nil
//                                        title:LangKey(@"删除")];

//    InstrumentalityItem *mutiSelect = [InstrumentalityItem item:@"onTapMenuItemMutiSelect:"
//                                      normalImage:[UIImage imageNamed:@"menu_choose"]
//                                    selectedImage:nil
//                                            title:LangKey(@"多选")];
//    if ([CommunicativeUtil canMessageBeForwarded:message])
//    {
//        [items addObject:reply];
//    }

    //: BOOL isMe = [message.from isEqualToString:[NIMSDK sharedSDK].loginManager.currentAccount];
    BOOL isMe = [message.from isEqualToString:[NIMSDK sharedSDK].loginManager.currentAccount];
    //: if (!isMe)
    if (!isMe)
    {
        //: [items addObject:report];
        [items addObject:report];
    }

    //: if (message.messageType == NIMMessageTypeText)
    if (message.messageType == NIMMessageTypeText)
    {
        //: [items addObject:copy];
        [items addObject:copy];
    }

    //: if ([NTESSessionUtil canMessageBeForwarded:message]) {
    if ([CommunicativeUtil accountForIndex:message]) {
        //: [items addObject:forword];
        [items addObject:forword];
    }
//    if ([CommunicativeUtil canMessageBeForwarded:message]) {
//        [items addObject:mark];
//        [items addObject:pin];
//    }
    //: if (message.messageType == NIMMessageTypeText){
    if (message.messageType == NIMMessageTypeText){
        //: [items addObject:translation];
        [items addObject:translation];
    }
    //: if ([NTESSessionUtil canMessageBeRevoked:message]) {
    if ([CommunicativeUtil behavior:message]) {
        //: [items addObject:revoke];
        [items addObject:revoke];
    }



//    [items addObject:delete];

//    if ([CommunicativeUtil canMessageBeForwarded:message])
//    {
//        [items addObject:mutiSelect];
//    }

//    if (message.messageType == NIMMessageTypeAudio)
//    {
//        InstrumentalityItem *audio2text = [InstrumentalityItem item:@"onTapMenuItemAudio2Text:"
//          normalImage:[UIImage imageNamed:@"menu_audio2text"]
//        selectedImage:nil
//                title:@"转文字".ntes_localized];
//
//        [items addObject:audio2text];
//    }
    //: return items;
    return items;
}

//: - (BOOL)clearThreadMessageAfterSent
- (BOOL)capableSignature
{
    //: return YES;
    return YES;
}

//: - (BOOL)shouldHandleReceipt{
- (BOOL)nowadaysSimple{
    //: return YES;
    return YES;
}

//: - (BOOL)disableProximityMonitor{
- (BOOL)nowPost{
    //: return [[NTESBundleSetting sharedConfig] disableProximityMonitor];
    return [[StackChoose need] nowPost];
}

//: - (NSArray<NIMInputEmoticonCatalog *> *)charlets
- (NSArray<TheyInputCatalog *> *)opinionOutput
{
    //: return nil;
    return nil;
}

//: - (BOOL)disableSelectedForMessage:(NIMMessage *)message {
- (BOOL)appropriateActive:(NIMMessage *)message {
    //: return ![NTESSessionUtil canMessageBeForwarded:message];
    return ![CommunicativeUtil accountForIndex:message];
}

//: - (BOOL)shouldHandleReceiptForMessage:(NIMMessage *)message
- (BOOL)managed:(NIMMessage *)message
{
    //文字，语音，图片，视频，文件，地址位置和自定义消息都支持已读回执，其他的不支持
    //: NIMMessageType type = message.messageType;
    NIMMessageType type = message.messageType;
    //: if (type == NIMMessageTypeCustom) {
    if (type == NIMMessageTypeCustom) {
        //: NIMCustomObject *object = (NIMCustomObject *)message.messageObject;
        NIMCustomObject *object = (NIMCustomObject *)message.messageObject;
        //: id attachment = object.attachment;
        id attachment = object.attachment;

        //: if ([attachment isKindOfClass:[NTESWhiteboardAttachment class]]) {
        if ([attachment isKindOfClass:[WhiteboardAttachment class]]) {
            //: return NO;
            return NO;
        }
    }



    //: return type == NIMMessageTypeText ||
    return type == NIMMessageTypeText ||
    //: type == NIMMessageTypeAudio ||
    type == NIMMessageTypeAudio ||
    //: type == NIMMessageTypeImage ||
    type == NIMMessageTypeImage ||
    //: type == NIMMessageTypeVideo ||
    type == NIMMessageTypeVideo ||
    //: type == NIMMessageTypeFile ||
    type == NIMMessageTypeFile ||
    //: type == NIMMessageTypeLocation ||
    type == NIMMessageTypeLocation ||
    //: type == NIMMessageTypeCustom;
    type == NIMMessageTypeCustom;
}

//: - (void)cleanThreadMessage
- (void)gender
{
    //: _threadMessage = nil;
    _threadMessage = nil;
}

//: - (NSArray<NSNumber *> *)inputBarItemTypes{
- (NSArray<NSNumber *> *)barWhen{
    //: return @[
    return @[
//        @(EnumInputBarItemTypeMore),
//        @(EnumInputBarItemTypeEmoticon),
//             @(EnumInputBarItemTypeVoice),
             //: @(EnumInputBarItemTypeTextAndRecord),
             @(EnumInputBarItemTypeTextAndRecord),
        //: @(EnumInputBarItemTypeSend),
        @(EnumInputBarItemTypeSend),
            //: ];
            ];
}

//: @end
@end

Byte *DischargeDataToByte(DischargeData *data) {
    if (data->magResolve < 111) return data->perceptible;
    for (int i = 0; i < data->decentDry; i++) {
        data->perceptible[i] ^= data->publisherSeem;
    }
    data->perceptible[data->decentDry] = 0;
    data->magResolve = 18;
	if (data->decentDry >= 3) {
		data->magazineArticle = data->perceptible[0];
		data->distributeSeemTide = data->perceptible[1];
		data->odeUnity = data->perceptible[2];
	}
    return data->perceptible;
}

NSString *StringFromDischargeData(DischargeData *data) {
    return [NSString stringWithUTF8String:(char *)DischargeDataToByte(data)];
}
